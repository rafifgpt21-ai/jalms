@startuml
title Manage Users Sequence Diagram
autonumber

actor "Admin" as Admin
participant "Web Client" as Client
participant "Admin" as AdminClass
participant "User" as User
database "Database" as Database

' View Users Flow
Admin -> Client: View Users List
activate Client
Client -> AdminClass: getUsers()
activate AdminClass
AdminClass -> User: findMany()
activate User
User -> Database: SELECT * FROM User...
activate Database
Database --> User: User[]
deactivate Database
User --> AdminClass: User[]
deactivate User
AdminClass --> Client: User[]
deactivate AdminClass
Client --> Admin: Display List of Users
deactivate Client

' User Action Choices
alt Create User
    Admin -> Client: Click "Add User"
    activate Client
    Client --> Admin: Display Create Form
    deactivate Client

    Admin -> Client: Fill Details & Submit
    activate Client
    note right of Admin: Name, Email, Role, etc.

    Client -> AdminClass: createUser(data)
    activate AdminClass
    AdminClass -> AdminClass: Validate Data
    activate AdminClass
    deactivate AdminClass

    opt Validation Pass
        AdminClass -> User: create({ data })
        activate User
        User -> Database: INSERT INTO User...
        activate Database
        Database --> User: Created User
        deactivate Database
        User --> AdminClass: User Object
        deactivate User
        AdminClass --> Client: Success Response
        Client --> Admin: Show Success & Refresh List
    else Validation Fail
        AdminClass --> Client: Error Response
        Client --> Admin: Show Error Message
    end
    deactivate AdminClass
    deactivate Client

else Edit User
    Admin -> Client: Click "Edit" on User
    activate Client
    Client -> AdminClass: getUser(id)
    activate AdminClass
    AdminClass -> User: findUnique({ where: { id } })
    activate User
    User -> Database: SELECT * FROM User...
    activate Database
    Database --> User: User Data
    deactivate Database
    User --> AdminClass: User Data
    deactivate User
    AdminClass --> Client: User Data
    deactivate AdminClass
    Client --> Admin: Display Edit Form with Data
    deactivate Client

    Admin -> Client: Update Details & Submit
    activate Client
    Client -> AdminClass: updateUser(id, data)
    activate AdminClass
    AdminClass -> AdminClass: Validate Data
    activate AdminClass
    deactivate AdminClass

    opt Validation Pass
        AdminClass -> User: update({ where: { id }, data })
        activate User
        User -> Database: UPDATE User...
        activate Database
        Database --> User: Updated User
        deactivate Database
        User --> AdminClass: User Object
        deactivate User
        AdminClass --> Client: Success Response
        Client --> Admin: Show Success & Refresh List
    else Validation Fail
        AdminClass --> Client: Error Response
        Client --> Admin: Show Error Message
    end
    deactivate AdminClass
    deactivate Client

else Delete User
    Admin -> Client: Click "Delete" on User
    activate Client
    Client --> Admin: Confirm Deletion?
    deactivate Client
    
    Admin -> Client: Confirm Yes
    activate Client
    Client -> AdminClass: deleteUser(id)
    activate AdminClass
    AdminClass -> User: delete({ where: { id } })
    activate User
    User -> Database: DELETE FROM User...
    activate Database
    Database --> User: Success
    deactivate Database
    User --> AdminClass: Success
    deactivate User
    AdminClass --> Client: Success Response
    deactivate AdminClass
    Client --> Admin: Show Success & Refresh List
    deactivate Client
end

@enduml
