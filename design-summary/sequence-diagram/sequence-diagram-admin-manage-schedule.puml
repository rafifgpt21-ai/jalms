@startuml
title Manage Schedule Sequence Diagram
autonumber

actor "Admin" as Admin
participant "Web Client" as Client
participant "Admin" as AdminClass
participant "Schedule" as Schedule
database "Database" as Database

' View Schedule Flow
Admin -> Client: View Schedule Grid
activate Client
Client -> AdminClass: getSchedule()
activate AdminClass
AdminClass -> Schedule: findMany()
activate Schedule
Schedule -> Database: SELECT * FROM Schedule...
activate Database
Database --> Schedule: Schedule[]
deactivate Database
Schedule --> AdminClass: Schedule[]
deactivate Schedule
AdminClass --> Client: Schedule[]
deactivate AdminClass
Client --> Admin: Display Schedule Grid
deactivate Client

' User Action Choices
alt Add Schedule Entry
    Admin -> Client: Click "Add Entry" (Cell)
    activate Client
    Client --> Admin: Display Add Form
    deactivate Client

    Admin -> Client: Fill Details & Submit
    activate Client
    note right of Admin: Subject, Time, Class, Teacher

    Client -> AdminClass: createScheduleEntry(data)
    activate AdminClass
    AdminClass -> AdminClass: Validate Data & Conflicts
    activate AdminClass
    deactivate AdminClass

    opt Validation Pass
        AdminClass -> Schedule: create({ data })
        activate Schedule
        Schedule -> Database: INSERT INTO Schedule...
        activate Database
        Database --> Schedule: Created Entry
        deactivate Database
        Schedule --> AdminClass: Entry Object
        deactivate Schedule
        AdminClass --> Client: Success Response
        Client --> Admin: Show Success & Refresh Grid
    else Validation Fail
        AdminClass --> Client: Error Response
        Client --> Admin: Show Error Message
    end
    deactivate AdminClass
    deactivate Client

else Edit Schedule Entry
    Admin -> Client: Click "Edit" on Entry
    activate Client
    Client -> AdminClass: getScheduleEntry(id)
    activate AdminClass
    AdminClass -> Schedule: findUnique({ where: { id } })
    activate Schedule
    Schedule -> Database: SELECT * FROM Schedule...
    activate Database
    Database --> Schedule: Entry Data
    deactivate Database
    Schedule --> AdminClass: Entry Data
    deactivate Schedule
    AdminClass --> Client: Entry Data
    deactivate AdminClass
    Client --> Admin: Display Edit Form with Data
    deactivate Client

    Admin -> Client: Update Details & Submit
    activate Client
    Client -> AdminClass: updateScheduleEntry(id, data)
    activate AdminClass
    AdminClass -> AdminClass: Validate Data & Conflicts
    activate AdminClass
    deactivate AdminClass

    opt Validation Pass
        AdminClass -> Schedule: update({ where: { id }, data })
        activate Schedule
        Schedule -> Database: UPDATE Schedule...
        activate Database
        Database --> Schedule: Updated Entry
        deactivate Database
        Schedule --> AdminClass: Entry Object
        deactivate Schedule
        AdminClass --> Client: Success Response
        Client --> Admin: Show Success & Refresh Grid
    else Validation Fail
        AdminClass --> Client: Error Response
        Client --> Admin: Show Error Message
    end
    deactivate AdminClass
    deactivate Client

else Delete Schedule Entry
    Admin -> Client: Click "Delete" on Entry
    activate Client
    Client --> Admin: Confirm Deletion?
    deactivate Client
    
    Admin -> Client: Confirm Yes
    activate Client
    Client -> AdminClass: deleteScheduleEntry(id)
    activate AdminClass
    AdminClass -> Schedule: delete({ where: { id } })
    activate Schedule
    Schedule -> Database: DELETE FROM Schedule...
    activate Database
    Database --> Schedule: Success
    deactivate Database
    Schedule --> AdminClass: Success
    deactivate Schedule
    AdminClass --> Client: Success Response
    deactivate AdminClass
    Client --> Admin: Show Success & Refresh Grid
    deactivate Client
end

@enduml
