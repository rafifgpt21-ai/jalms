@startuml
title Manage Subject Sequence Diagram
autonumber

actor "Admin" as Admin
participant "Web Client" as Client
participant "Admin" as AdminClass
participant "Subject" as Subject
database "Database" as Database

' View Subjects Flow
Admin -> Client: View Subjects List
activate Client
Client -> AdminClass: getSubjects()
activate AdminClass
AdminClass -> Subject: findMany()
activate Subject
Subject -> Database: SELECT * FROM Subject...
activate Database
Database --> Subject: Subject[]
deactivate Database
Subject --> AdminClass: Subject[]
deactivate Subject
AdminClass --> Client: Subject[]
deactivate AdminClass
Client --> Admin: Display List of Subjects
deactivate Client

' User Action Choices
alt Create Subject
    Admin -> Client: Click "Add Subject"
    activate Client
    Client --> Admin: Display Create Form
    deactivate Client

    Admin -> Client: Fill Details & Submit
    activate Client
    note right of Admin: Name, Code, Description

    Client -> AdminClass: createSubject(data)
    activate AdminClass
    AdminClass -> AdminClass: Validate Data
    activate AdminClass
    deactivate AdminClass

    opt Validation Pass
        AdminClass -> Subject: create({ data })
        activate Subject
        Subject -> Database: INSERT INTO Subject...
        activate Database
        Database --> Subject: Created Subject
        deactivate Database
        Subject --> AdminClass: Subject Object
        deactivate Subject
        AdminClass --> Client: Success Response
        Client --> Admin: Show Success & Refresh List
    else Validation Fail
        AdminClass --> Client: Error Response
        Client --> Admin: Show Error Message
    end
    deactivate AdminClass
    deactivate Client

else Edit Subject
    Admin -> Client: Click "Edit" on Subject
    activate Client
    Client -> AdminClass: getSubject(id)
    activate AdminClass
    AdminClass -> Subject: findUnique({ where: { id } })
    activate Subject
    Subject -> Database: SELECT * FROM Subject...
    activate Database
    Database --> Subject: Subject Data
    deactivate Database
    Subject --> AdminClass: Subject Data
    deactivate Subject
    AdminClass --> Client: Subject Data
    deactivate AdminClass
    Client --> Admin: Display Edit Form with Data
    deactivate Client

    Admin -> Client: Update Details & Submit
    activate Client
    Client -> AdminClass: updateSubject(id, data)
    activate AdminClass
    AdminClass -> AdminClass: Validate Data
    activate AdminClass
    deactivate AdminClass

    opt Validation Pass
        AdminClass -> Subject: update({ where: { id }, data })
        activate Subject
        Subject -> Database: UPDATE Subject...
        activate Database
        Database --> Subject: Updated Subject
        deactivate Database
        Subject --> AdminClass: Subject Object
        deactivate Subject
        AdminClass --> Client: Success Response
        Client --> Admin: Show Success & Refresh List
    else Validation Fail
        AdminClass --> Client: Error Response
        Client --> Admin: Show Error Message
    end
    deactivate AdminClass
    deactivate Client

else Delete Subject
    Admin -> Client: Click "Delete" on Subject
    activate Client
    Client --> Admin: Confirm Deletion?
    deactivate Client
    
    Admin -> Client: Confirm Yes
    activate Client
    Client -> AdminClass: deleteSubject(id)
    activate AdminClass
    AdminClass -> Subject: delete({ where: { id } })
    activate Subject
    Subject -> Database: DELETE FROM Subject...
    activate Database
    Database --> Subject: Success
    deactivate Database
    Subject --> AdminClass: Success
    deactivate Subject
    AdminClass --> Client: Success Response
    deactivate AdminClass
    Client --> Admin: Show Success & Refresh List
    deactivate Client
end

@enduml
