@startuml
title Change Password Sequence Diagram
autonumber

actor "User" as User
participant "Web Client" as UI
participant "Server Action" as Action
participant "Prisma ORM" as Prisma
database "Database" as DB

User -> UI: Request Password Change
activate UI
UI --> User: Display Password Form
deactivate UI

User -> UI: Submit Old & New Password
activate UI
UI -> Action: changePassword(old Pwd, new Pwd)
activate Action
Action -> Action: Validate Password Strength
activate Action
deactivate Action

Action -> Prisma: findUnique({ where: { id } })
activate Prisma
Prisma -> DB: SELECT password FROM User...
activate DB
DB --> Prisma: Hashed Password
deactivate DB
Prisma --> Action: User Data
deactivate Prisma

Action -> Action: Verify Old Password
activate Action
deactivate Action

opt Verification Pass
    Action -> Prisma: update({ data: { password: newHash } })
    activate Prisma
    Prisma -> DB: UPDATE User...
    activate DB
    DB --> Prisma: Success
    deactivate DB
    Prisma --> Action: Success
    deactivate Prisma
    Action --> UI: Success Response
    UI --> User: Password Changed Successfully
else Verification Fail
    Action --> UI: Error Response
    UI --> User: Invalid Old Password or Weak Password
end
deactivate Action
deactivate UI

@enduml
