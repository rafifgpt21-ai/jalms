@startuml
title Manage Semester Sequence Diagram
autonumber

actor "Admin" as Admin
participant "Web Client" as Client
participant "Admin" as AdminClass
participant "Term" as Term
database "Database" as Database

' View Semesters Flow
Admin -> Client: View Academic Year Details
activate Client
Client -> AdminClass: fetchSemesters(academicYearId)
activate AdminClass
AdminClass -> Term: findMany({ where: { academicYearId } })
activate Term
Term -> Database: SELECT * FROM Semester...
activate Database
Database --> Term: Semester[]
deactivate Database
Term --> AdminClass: Semester[]
deactivate Term
AdminClass --> Client: Semester[]
deactivate AdminClass
Client --> Admin: Display List of Semesters
deactivate Client

' User Action Choices
alt Create Semester
    Admin -> Client: Click "Add Semester"
    activate Client
    Client --> Admin: Display Create Form
    deactivate Client

    Admin -> Client: Fill Details & Submit
    activate Client
    note right of Admin: Type, Start Date, End Date

    Client -> AdminClass: createSemester(data)
    activate AdminClass
    AdminClass -> AdminClass: Validate Data
    activate AdminClass
    deactivate AdminClass

    opt Validation Pass
        AdminClass -> Term: create({ data })
        activate Term
        Term -> Database: INSERT INTO Semester...
        activate Database
        Database --> Term: Created Semester
        deactivate Database
        Term --> AdminClass: Semester Object
        deactivate Term
        AdminClass --> Client: Success Response
        Client --> Admin: Show Success & Refresh List
    else Validation Fail
        AdminClass --> Client: Error Response
        Client --> Admin: Show Error Message
    end
    deactivate AdminClass
    deactivate Client

else Edit Semester
    Admin -> Client: Click "Edit" on Semester
    activate Client
    Client -> AdminClass: getSemester(id)
    activate AdminClass
    AdminClass -> Term: findUnique({ where: { id } })
    activate Term
    Term -> Database: SELECT * FROM Semester...
    activate Database
    Database --> Term: Semester Data
    deactivate Database
    Term --> AdminClass: Semester Data
    deactivate Term
    AdminClass --> Client: Semester Data
    deactivate AdminClass
    Client --> Admin: Display Edit Form with Data
    deactivate Client

    Admin -> Client: Update Details & Submit
    activate Client
    Client -> AdminClass: updateSemester(id, data)
    activate AdminClass
    AdminClass -> AdminClass: Validate Data
    activate AdminClass
    deactivate AdminClass

    opt Validation Pass
        AdminClass -> Term: update({ where: { id }, data })
        activate Term
        Term -> Database: UPDATE Semester...
        activate Database
        Database --> Term: Updated Semester
        deactivate Database
        Term --> AdminClass: Semester Object
        deactivate Term
        AdminClass --> Client: Success Response
        Client --> Admin: Show Success & Refresh List
    else Validation Fail
        AdminClass --> Client: Error Response
        Client --> Admin: Show Error Message
    end
    deactivate AdminClass
    deactivate Client

else Delete Semester
    Admin -> Client: Click "Delete" on Semester
    activate Client
    Client --> Admin: Confirm Deletion?
    deactivate Client
    
    Admin -> Client: Confirm Yes
    activate Client
    Client -> AdminClass: deleteSemester(id)
    activate AdminClass
    AdminClass -> Term: delete({ where: { id } })
    activate Term
    Term -> Database: DELETE FROM Semester...
    activate Database
    Database --> Term: Success
    deactivate Database
    Term --> AdminClass: Success
    deactivate Term
    AdminClass --> Client: Success Response
    deactivate AdminClass
    Client --> Admin: Show Success & Refresh List
    deactivate Client
end

@enduml
